function contains(t,i){for(var n in t)if(t[n].albumname==i)return n;return-1}!function(t,i){"use strict";var n={};i.module("spotify",[]).value("settings",n).provider("Spotify",function(){n.clientId=null,n.redirectUri=null,n.scope=null,n.accessToken=null,this.setClientId=function(t){return n.clientId=t,n.clientId},this.getClientId=function(){return n.clientId},this.setRedirectUri=function(t){return n.redirectUri=t,n.redirectUri},this.getRedirectUri=function(){return n.redirectUri},this.setScope=function(t){return n.scope=t,n.scope};var e={};e.toQueryString=function(t){var i=[];for(var n in t)t.hasOwnProperty(n)&&i.push(encodeURIComponent(n)+"="+encodeURIComponent(t[n]));return i.join("&")},n.version="v1",n.apiBase="https://api.spotify.com/"+n.version,this.$get=["$q","$http","$window",function(s,r,o){function a(){this.clientId=n.clientId,this.redirectUri=n.redirectUri,this.apiBase=n.apiBase,this.scope=n.scope,this.accessToken=null,this.toQueryString=e.toQueryString}return a.prototype.api=function(t,i,n,e,o){var a=s.defer();return r({url:this.apiBase+t,method:i?i:"GET",params:n,data:e,headers:o}).success(function(t){a.resolve(t)}).error(function(t){a.reject(t)}),a.promise},a.prototype.search=function(t,i,n){return n=n||{},n.q=t,n.type=i,this.api("/search","GET",n)},a.prototype.getAlbum=function(t){return t=-1===t.indexOf("spotify:")?t:t.split(":")[2],this.api("/albums/"+t)},a.prototype.getAlbums=function(t){return t=i.isString(t)?t.split(","):t,i.forEach(t,function(i,n){t[n]=i.indexOf("spotify:")>-1?i.split(":")[2]:i}),this.api("/albums","GET",{ids:t?t.toString():""})},a.prototype.getAlbumTracks=function(t,i){return t=-1===t.indexOf("spotify:")?t:t.split(":")[2],this.api("/albums/"+t+"/tracks","GET",i)},a.prototype.getArtist=function(t){return t=-1===t.indexOf("spotify:")?t:t.split(":")[2],this.api("/artists/"+t)},a.prototype.getArtists=function(t){return t=i.isString(t)?t.split(","):t,i.forEach(t,function(i,n){t[n]=i.indexOf("spotify:")>-1?i.split(":")[2]:i}),this.api("/artists/","GET",{ids:t?t.toString():""})},a.prototype.getArtistAlbums=function(t,i){return t=-1===t.indexOf("spotify:")?t:t.split(":")[2],this.api("/artists/"+t+"/albums","GET",i)},a.prototype.getArtistTopTracks=function(t,i){return t=-1===t.indexOf("spotify:")?t:t.split(":")[2],this.api("/artists/"+t+"/top-tracks","GET",{country:i})},a.prototype.getRelatedArtists=function(t){return t=-1===t.indexOf("spotify:")?t:t.split(":")[2],this.api("/artists/"+t+"/related-artists")},a.prototype.getTrack=function(t){return t=-1===t.indexOf("spotify:")?t:t.split(":")[2],this.api("/tracks/"+t)},a.prototype.getTracks=function(t){return t=i.isString(t)?t.split(","):t,i.forEach(t,function(i,n){t[n]=i.indexOf("spotify:")>-1?i.split(":")[2]:i}),this.api("/tracks/","GET",{ids:t?t.toString():""})},a.prototype.getUserPlaylists=function(t,i){return this.api("/users/"+t+"/playlists","GET",i,null,{Authorization:"Bearer "+this.authToken})},a.prototype.getPlaylist=function(t,i,n){return this.api("/users/"+t+"/playlists/"+i,"GET",n,null,{Authorization:"Bearer "+this.authToken})},a.prototype.getPlaylistTracks=function(t,i,n){return this.api("/users/"+t+"/playlists/"+i+"/tracks","GET",n,null,{Authorization:"Bearer "+this.authToken})},a.prototype.createPlaylist=function(t,i){return this.api("/users/"+t+"/playlists","POST",null,i,{Authorization:"Bearer "+this.authToken,"Content-Type":"application/json"})},a.prototype.addPlaylistTracks=function(t,n,e,s){return e=i.isArray(e)?e:e.split(","),i.forEach(e,function(t,i){e[i]=-1===t.indexOf("spotify:")?"spotify:track:"+t:t}),this.api("/users/"+t+"/playlists/"+n+"/tracks","POST",{uris:e.toString(),position:s?s.position:null},null,{Authorization:"Bearer "+this.authToken,"Content-Type":"application/json"})},a.prototype.removePlaylistTracks=function(t,n,e){e=i.isArray(e)?e:e.split(",");var s;return i.forEach(e,function(t,i){s=e[i],e[i]={uri:-1===s.indexOf("spotify:")?"spotify:track:"+s:s}}),this.api("/users/"+t+"/playlists/"+n+"/tracks","DELETE",null,{tracks:e},{Authorization:"Bearer "+this.authToken,"Content-Type":"application/json"})},a.prototype.replacePlaylistTracks=function(t,n,e){e=i.isArray(e)?e:e.split(",");var s;return i.forEach(e,function(t,i){s=e[i],e[i]=-1===s.indexOf("spotify:")?"spotify:track:"+s:s}),this.api("/users/"+t+"/playlists/"+n+"/tracks","PUT",{uris:e.toString()},null,{Authorization:"Bearer "+this.authToken,"Content-Type":"application/json"})},a.prototype.updatePlaylistDetails=function(t,i,n){return this.api("/users/"+t+"/playlists/"+i,"PUT",null,n,{Authorization:"Bearer "+this.authToken,"Content-Type":"application/json"})},a.prototype.getUser=function(t){return this.api("/users/"+t)},a.prototype.getCurrentUser=function(){return this.api("/me","GET",null,null,{Authorization:"Bearer "+this.authToken})},a.prototype.getSavedUserTracks=function(t){return this.api("/me/tracks","GET",t,null,{Authorization:"Bearer "+this.authToken})},a.prototype.userTracksContains=function(t){return t=i.isString(t)?t.split(","):t,i.forEach(t,function(i,n){t[n]=i.indexOf("spotify:")>-1?i.split(":")[2]:i}),this.api("/me/tracks/contains","GET",{ids:t.toString()},null,{Authorization:"Bearer "+this.authToken})},a.prototype.saveUserTracks=function(t){return t=i.isString(t)?t.split(","):t,i.forEach(t,function(i,n){t[n]=i.indexOf("spotify:")>-1?i.split(":")[2]:i}),this.api("/me/tracks","PUT",{ids:t.toString()},null,{Authorization:"Bearer "+this.authToken})},a.prototype.removeUserTracks=function(t){return this.api("/me/tracks","DELETE",{ids:t.toString()},null,{Authorization:"Bearer "+this.authToken,"Content-Type":"application/json"})},a.prototype.setAuthToken=function(t){return this.authToken=t,this.authToken},a.prototype.login=function(){function i(t){c&&c.close(),e.setAuthToken(t.data),n.resolve(t.data)}var n=s.defer(),e=this,r=400,a=500,u=screen.width/2-r/2,p=screen.height/2-a/2,l={client_id:this.clientId,redirect_uri:this.redirectUri,scope:this.scope||"",response_type:"token"},c=t.open("https://accounts.spotify.com/authorize?"+this.toQueryString(l),"Spotify","menubar=no,location=no,resizable=no,scrollbars=no,status=no,width="+r+",height="+a+",top="+p+",left="+u);return o.addEventListener("message",i,!1),n.promise},new a}]})}(window,angular);var app=angular.module("top5app",["ui.sortable","firebase","spotify"]);app.controller("AppControl",["$scope","$firebase","Spotify",function(t,i,n){var e=new Firebase("https://top52014test.firebaseIO.com/"),s=i(e.child("years").child("2014"));t.albumList=s.$asArray(),t.submissions=[{bandname:"1st",albumname:"1"},{bandname:"2nd",albumname:"2"},{bandname:"3rd",albumname:"3"}],t.addAlbum=function(){t.submissions.length<10&&contains(t.submissions,t.albumname)<0&&t.submissions.push({bandname:t.bandname,albumname:t.albumname}),t.bandname="",t.albumname=""},t.deleteItem=function(i){t.submissions.splice(i,1)},t.submitAlbums=function(){for(var i in t.submissions){var n=t.submissions[i],e=10-i,s=contains(t.albumList,n.albumname);0>s?t.albumList.$add({albumname:n.albumname,bandname:n.bandname,score:e,votes:[{user:t.userName,points:e}]}):(console.log("i: "+i),console.log("index: "+s),console.log(t.albumList[s]),t.albumList[s].score+=e,t.albumList[s].votes.push({user:t.userName,points:e}),t.albumList.$save(t.albumList[s]))}t.submissions=[]},t.testSpotify=function(){n.search("Nirvana","artist").then(function(t){console.log(t)})}}]);